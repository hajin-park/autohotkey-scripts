;
; AutoHotkey Version: 2.x
; Language:       English
; Platform:       Windows 10
; Author:         Hajin Park <hajin1819@gmail.com>
;
; Script Function:
;	Automate diamond shop exploit
;

#Warn
#SingleInstance Force
DetectHiddenText "On"
DetectHiddenWindows "On"
SetControlDelay -1
SendMode "Input"  ; Recommended for new scripts due to its superior speed and reliability.
SetWorkingDir A_ScriptDir  ; Ensures a consistent starting directory.
CoordMode("Mouse", "Client")
CoordMode("Pixel", "Client")

Global ClientID := WinGetID("Minecraft* 1.12.2 - Multiplayer (3rd-party Server)")
Global clickX := 0
Global clickY := 0

WinActivate(ClientID)


Navigate_Shop(findUI, findButton1, findButton2, uiCoords, buttonCoords)
{
    Global
    while !ImageSearch(&clickX, &clickY, uiCoords[1], uiCoords[2], uiCoords[3], uiCoords[4], Format("assets\{}.png", findUI))
    {
        if ImageSearch(&clickX, &clickY, buttonCoords[1], buttonCoords[2], buttonCoords[3], buttonCoords[4], Format("assets\{}.png", findButton1)) or ImageSearch(&clickX, &clickY, buttonCoords[1], buttonCoords[2], buttonCoords[3], buttonCoords[4], Format("assets\{}.png", findButton2))
        {
            MouseClick("Left", clickX, clickY)
            Sleep(100)
        }
    }
}

MineBlock(arg)
{
    Global
    MouseClick("Left", 0, 0,,,"D")
    Send("{Space down}")
    while ImageSearch(&clickX, &clickY, 600, 936, 1317, 1015, Format("assets\{}.png", arg))
    {
        Sleep(100)
    }
    MouseClick("Left", 0, 0,,,"U")
    Send("{Space up}")
}

MoveCamera(arg)
{
    if (arg = "up")
    {
        MouseMove(0, -100, 100)
    }
    else if (arg = "down")
    {
        MouseMove(0, 100, 100)
    }
}

CraftItem(arg)
{
    Global

    if (arg = "coal_block")
    {
        while ImageSearch(&clickX, &clickY, 361, 300, 876, 807, Format("assets\{}.png", arg))
        {
            Send("{Shift down}")
            MouseClick("Left", clickX, clickY)
            Sleep(100)
            if ImageSearch(&clickX, &clickY, 1395, 300, 1493, 396, Format("assets\{}.png", arg)) or ImageSearch(&clickX, &clickY, 1395, 300, 1493, 396, Format("assets\{}_highlighted.png", arg))
            {
                MouseClick("Left", clickX, clickY)
                Sleep(100)
            }
            Send("{Shift up}")
        }
    }

    else if (arg = "diamond_sword")
    {

    }

    else if (arg = "stick")
    {

    }

    Send("{Esc}")
}

UseShop(arg)
{
    Global

    while !ImageSearch(&clickX, &clickY, 630, 155, 920, 200, "assets\shop_ui.png")
    {
        Send("y")
        Sleep(100)
    }

    if (arg = "coal_ore")
    {
        Navigate_Shop("mining_shop_ui", "gold_ingot", "gold_ingot_highlighted", [630, 80, 780, 150], [780, 276, 1138, 419])
        Navigate_Shop("buy_shop_ui", "coal_ore", "coal_ore_highlighted", [632, 80, 774, 129], [635, 130, 1286, 350])
        Navigate_Shop("buy_more_shop_ui", "buy_more", "buy_more_highlighted", [630, 227, 773, 272], [850, 420, 1068, 562])
        Navigate_Shop("mining_shop_ui", "seven_stacks_coal_ore", "seven_stacks_coal_ore_highlighted", [630, 80, 780, 150], [634, 276, 1285, 347])
    }

    else if (arg = "diamond_ore")
    {
        Navigate_Shop("mining_shop_ui", "gold_ingot", "gold_ingot_highlighted", [630, 80, 780, 150], [780, 276, 1138, 419])
        Navigate_Shop("buy_shop_ui", "diamond_ore", "diamond_ore_highlighted", [632, 80, 774, 129], [635, 130, 1286, 350])
        Navigate_Shop("buy_more_shop_ui", "buy_more", "buy_more_highlighted", [630, 227, 773, 272], [850, 420, 1068, 562])
        Navigate_Shop("mining_shop_ui", "one_stack_diamond_ore", "one_stack_diamond_ore_highlighted", [630, 80, 780, 150], [634, 276, 1285, 347])
    }

    else if (arg = "coal_block")
    {
        Navigate_Shop("block_shop_ui", "grass_block", "grass_block_highlighted", [630, 80, 790, 120], [780, 276, 1138, 419])
        Navigate_Shop("paper", "block_shop_ui", "block_shop_ui", [995, 492, 1067, 564], [632, 80, 774, 129])
        Navigate_Shop("coal_block", "paper", "paper_highlighted", [637, 132, 1283, 419], [995, 492, 1067, 564])
        while ImageSearch(&clickX, &clickY, 633, 615, 1301, 933, "assets\coal_block.png")
        {
            if ImageSearch(&clickX, &clickY, 637, 132, 1283, 419, "assets\coal_block.png") or ImageSearch(&clickX, &clickY, 637, 132, 1283, 419, "assets\coal_block_highlighted.png")
            {
                MouseClick("Middle", clickX, clickY)
                Sleep(100)
            }
        }  
    }

    else if (arg = "diamond_sword")
    {
        Navigate_Shop("armor_shop_ui", "diamond_chestplate", "diamond_chestplate_highlighted", [630, 80, 790, 120], [780, 276, 1138, 419])
    }

    Send("{Esc}")
}

Main()
{
    Global
    {
        UseShop("coal_ore")
        Sleep(100)
        MouseClick("Left", 0, 0)
        Sleep(100)
        MoveCamera("down")
        MineBlock("coal_ore")
        MouseClick("Left", 0, 0)
        MoveCamera("up")

        while !ImageSearch(&clickX, &clickY, 760, 244, 858, 306, "assets\crafting.png")
        {
            MouseClick("Right", clickX, clickY)
            Sleep(100)
        }

        CraftItem("coal_block")
        UseShop("coal_block")
        UseShop("coal_ore")
    }
}


^Esc::ExitApp
^x::Pause
^t::Main()
^y::MineBlock("coal_ore")
